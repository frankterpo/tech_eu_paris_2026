import{m as _,j as e,u as q,a as R,b as L,r as i}from"./helpers-a_il61DA.js";const v="https://tech-eu-paris-2026-0d53df71.alpic.live/api/webhooks/cala-trigger",h="https://console.cala.ai/triggers";function z(){const{isSuccess:b,output:y,isPending:C,input:m}=q();R();const r=L("create_triggers_batch"),[t,o]=i.useState(new Set),[d,f]=i.useState(""),[u,S]=i.useState(""),[p,k]=i.useState(!1),[x,j]=i.useState(null),a=y;if(i.useEffect(()=>{r.isSuccess&&k(!0)},[r.isSuccess]),C||!b||!a)return e.jsxs("div",{className:"loading",children:["Loading trigger setup",m?.company?` for ${m.company}`:"","..."]});const w=s=>{o(c=>{const n=new Set(c);return n.has(s)?n.delete(s):n.add(s),n})},A=()=>{t.size===a.categories.length?o(new Set):o(new Set(a.categories.map(s=>s.id)))},T=/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(d),g=t.size>0&&T&&!r.isPending&&!p,E=()=>{g&&r.callTool({company:a.company,domain:a.domain||void 0,email:d,categories:Array.from(t),custom_query:u||void 0})},N=(s,c)=>{navigator.clipboard.writeText(s).then(()=>{j(c),setTimeout(()=>j(null),2e3)}).catch(()=>{})},l=r.data?.structuredContent;return e.jsxs("div",{className:"widget trg-setup",children:[e.jsxs("div",{className:"trg-header",children:[e.jsx("div",{className:"trg-icon-wrap",children:e.jsx("span",{className:"trg-icon",children:"ðŸ””"})}),e.jsxs("div",{children:[e.jsxs("div",{className:"trg-title",children:["Monitor ",a.company]}),e.jsxs("div",{className:"trg-subtitle",children:["Track key milestones. Triggers created via"," ",e.jsx("a",{href:h,target:"_blank",rel:"noopener",style:{color:"#2563eb"},children:"Cala AI Console"})," ","â€” alerts forwarded to your email via Resend."]})]})]}),p&&l?e.jsxs("div",{className:"trg-success",children:[e.jsx("div",{className:"trg-success-icon",children:"âœ…"}),e.jsxs("div",{className:"trg-success-title",children:[l.triggers?.length||0," Triggers Saved"]}),e.jsxs("div",{className:"trg-success-subtitle",children:["Alerts for ",e.jsx("b",{children:a.company})," â†’ ",e.jsx("b",{children:l.email})]}),e.jsxs("div",{className:"trg-instructions",children:[e.jsx("div",{className:"trg-instructions-title",children:"Set up native Cala triggers:"}),e.jsxs("div",{className:"trg-step",children:[e.jsx("span",{className:"trg-step-num",children:"1"}),e.jsxs("span",{children:["Open"," ",e.jsx("a",{href:h,target:"_blank",rel:"noopener",style:{color:"#2563eb",fontWeight:600},children:"console.cala.ai/triggers"})]})]}),e.jsxs("div",{className:"trg-step",children:[e.jsx("span",{className:"trg-step-num",children:"2"}),e.jsx("span",{children:"Create a trigger for each query below (click to copy):"})]}),e.jsx("div",{className:"trg-query-list",children:(l.queriesForConsole||[]).map((s,c)=>e.jsxs("button",{className:"trg-query-item",onClick:()=>N(s.query,s.name),title:"Click to copy query",children:[e.jsx("span",{className:"trg-query-name",children:s.name}),e.jsx("span",{className:"trg-query-text",children:s.query}),e.jsx("span",{className:"trg-query-copy",children:x===s.name?"âœ“ Copied":"Copy"})]},c))}),e.jsxs("div",{className:"trg-step",children:[e.jsx("span",{className:"trg-step-num",children:"3"}),e.jsx("span",{children:"Add webhook notification with this URL:"})]}),e.jsxs("button",{className:"trg-webhook-url",onClick:()=>N(v,"webhook"),title:"Click to copy webhook URL",children:[e.jsx("code",{children:v}),e.jsx("span",{className:"trg-query-copy",children:x==="webhook"?"âœ“ Copied":"Copy"})]}),e.jsxs("div",{className:"trg-step",children:[e.jsx("span",{className:"trg-step-num",children:"4"}),e.jsxs("span",{children:["When Cala detects changes, we email ",e.jsx("b",{children:l.email})," via Resend"]})]})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"trg-section",children:[e.jsxs("div",{className:"trg-section-header",children:[e.jsx("div",{className:"trg-section-label",children:"Milestone Categories"}),e.jsx("button",{className:"trg-select-all",onClick:A,children:t.size===a.categories.length?"Deselect All":"Select All"})]}),e.jsx("div",{className:"trg-categories",children:a.categories.map(s=>e.jsxs("button",{className:`trg-cat-btn ${t.has(s.id)?"trg-cat-active":""}`,onClick:()=>w(s.id),children:[e.jsx("span",{className:"trg-cat-icon",children:s.icon}),e.jsx("span",{className:"trg-cat-label",children:s.label}),t.has(s.id)&&e.jsx("span",{className:"trg-cat-check",children:"âœ“"})]},s.id))})]}),e.jsxs("div",{className:"trg-section",children:[e.jsx("div",{className:"trg-section-label",children:"Custom Focus (optional)"}),e.jsx("input",{className:"trg-input",type:"text",placeholder:'e.g., "European expansion", "API launch"...',value:u,onChange:s=>S(s.target.value)})]}),e.jsxs("div",{className:"trg-section",children:[e.jsx("div",{className:"trg-section-label",children:"Email for Alerts"}),e.jsx("input",{className:"trg-input",type:"email",placeholder:"your@email.com",value:d,onChange:s=>f(s.target.value)})]}),e.jsx("button",{className:`trg-submit ${g?"":"trg-submit-disabled"}`,onClick:E,disabled:!g,children:r.isPending?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"cala-pulse"}),"Setting up ",t.size," triggers..."]}):`Set Up ${t.size} Trigger${t.size!==1?"s":""} â†’`}),e.jsxs("div",{className:"trg-powered",children:["Triggers via"," ",e.jsx("a",{href:h,target:"_blank",rel:"noopener",style:{color:"#2563eb"},children:e.jsx("b",{children:"Cala.ai"})})," ","Â· Alerts via ",e.jsx("b",{children:"Resend"})]})]})]})}_(e.jsx(z,{}));
