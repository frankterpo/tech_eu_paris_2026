import{R as w,j as e,m as pe,u as he,b as Z,a as ue,D as le}from"./helpers-a_il61DA.js";const G=r=>r==="done"?"âœ“":r==="running"?"â—":"â—‹",P=r=>r==="done"?"node-done":r==="running"?"node-running":"node-pending",re=r=>r>=70?"score-high":r>=40?"score-mid":"score-low",oe=r=>r==="STRONG_YES"?"decision-strong-yes":r==="PASS"||r==="KILL"?"decision-pass":"decision-proceed",z=(r,y)=>r.length>y?r.slice(0,y)+"â€¦":r;function U(r,y){return r.filter(k=>k.phase.startsWith(y))}function X({feed:r,isDone:y,isRunning:k,phasePrefix:g}){const m=r.filter(n=>n.phase===`${g}_query`),b=r.filter(n=>n.phase===`${g}_tool`),$=r.filter(n=>n.phase===`${g}_think`),h=r.find(n=>n.phase===`${g}_done`),d=new Set([`${g}_query`,`${g}_tool`,`${g}_think`,`${g}_done`]),v=r.filter(n=>!d.has(n.phase)),p=new Set,t=v.filter(n=>p.has(n.text)?!1:(p.add(n.text),!0));let f=0;for(const n of b){const a=n.text.match(/Ã—(\d+)/g);if(a)for(const c of a)f+=parseInt(c.slice(1),10);else f+=1}const N=n=>{if(y)return"done";if(!k||m.length===0)return"pending";const a=Math.min(f,m.length-1);return n<a?"done":n===a?"active":"pending"},l=[...b,...$].sort((n,a)=>n.ts.localeCompare(a.ts));return e.jsxs("div",{className:"subtask-feed",children:[m.length>0&&e.jsx("div",{className:"st-list",children:m.map((n,a)=>{const c=N(a),u=c==="active"&&a===Math.min(f,m.length-1);return e.jsxs("div",{className:`st-item st-${c}${u?" st-latest":""}`,children:[e.jsx("span",{className:"st-icon",children:c==="done"?"âœ“":c==="active"?"âŸ³":"â—‹"}),e.jsx("span",{className:"st-text",children:n.text}),c==="active"&&e.jsx("span",{className:"st-dots"})]},a)})}),t.length>0&&e.jsx("div",{className:"st-list",children:t.map((n,a)=>e.jsxs("div",{className:"st-item st-done",children:[e.jsx("span",{className:"st-icon",children:"âœ“"}),e.jsx("span",{className:"st-text",children:n.text})]},`x-${a}`))}),l.length>0&&e.jsx("div",{className:"st-activity",children:l.slice(-4).map((n,a)=>{const c=a===Math.min(l.length,4)-1&&k,u=n.phase.endsWith("_tool");return e.jsxs("div",{className:"st-activity-block",children:[e.jsxs("div",{className:`st-activity-line ${u?"st-act-tool":"st-act-think"}`,children:[e.jsx("span",{className:"st-act-verb",children:u?"Invoked":"Thinking"}),e.jsx("span",{className:"st-act-text",children:n.text.replace(/^âš¡\s*/,"")}),c&&e.jsx("span",{className:"st-dots"})]}),u&&(n.toolInput||n.toolOutput)&&e.jsxs("div",{className:"st-tool-io",children:[n.toolInput&&e.jsx("div",{className:"st-tool-input",children:z(n.toolInput,150)}),n.toolOutput&&e.jsx("div",{className:"st-tool-output",children:z(n.toolOutput,300)})]})]},a)})}),k&&m.length===0&&l.length===0&&e.jsxs("div",{className:"feed-item feed-live",children:[e.jsx("span",{className:"st-dots"})," ",g==="analyst_1"?"Initializing market analystâ€¦":g==="analyst_2"?"Initializing competition analystâ€¦":g==="analyst_3"?"Initializing traction analystâ€¦":g==="associate"?"Synthesizing analyst findingsâ€¦":g==="partner"?"Preparing investment decisionâ€¦":"Deploying queriesâ€¦"]}),h&&e.jsx("div",{className:"feed-item feed-done",children:h.text})]})}function xe({scores:r}){const m=r.length,b=p=>Math.PI*2*p/m-Math.PI/2,$=(p,t)=>({x:90+t*Math.cos(b(p)),y:90+t*Math.sin(b(p))}),h=p=>Array.from({length:m},(t,f)=>`${$(f,p).x},${$(f,p).y}`).join(" "),d=r.map((p,t)=>$(t,p.value/100*65)),v=p=>p>=70?"#2e7d32":p>=40?"#f57c00":"#c62828";return e.jsx("div",{className:"radar-wrap",children:e.jsxs("svg",{viewBox:"0 0 180 185",className:"radar-svg",children:[[25,50,75,100].map(p=>e.jsx("polygon",{points:h(p/100*65),fill:"none",stroke:"currentColor",strokeOpacity:.12,strokeWidth:.7},p)),r.map((p,t)=>e.jsx("line",{x1:90,y1:90,x2:$(t,65).x,y2:$(t,65).y,stroke:"currentColor",strokeOpacity:.1,strokeWidth:.5},t)),e.jsx("polygon",{points:d.map(p=>`${p.x},${p.y}`).join(" "),fill:"#2563eb",fillOpacity:.18,stroke:"#2563eb",strokeWidth:1.5,className:"radar-area"}),r.map((p,t)=>{const f=d[t],N=$(t,81);return e.jsxs("g",{children:[e.jsx("circle",{cx:f.x,cy:f.y,r:3.5,fill:v(p.value)}),e.jsx("text",{x:N.x,y:N.y-1,textAnchor:"middle",className:"radar-label",children:p.label}),e.jsx("text",{x:N.x,y:N.y+9,textAnchor:"middle",className:"radar-value",fill:v(p.value),children:p.value})]},t)})]})})}function ge({liveUpdates:r,analysts:y,associate:k,partner:g,rubric:m,decision:b,evidence:$}){const h=[],d={};for(const t of $){const f=t.source||"unknown";d[f]=(d[f]||0)+1}for(const t of r){const f=t.phase.startsWith("analyst_1")?"Market Analyst":t.phase.startsWith("analyst_2")?"Competition Analyst":t.phase.startsWith("analyst_3")?"Traction Analyst":t.phase.startsWith("associate")?"Associate":t.phase.startsWith("partner")?"Partner":t.phase.startsWith("init")?"Orchestrator":t.phase.startsWith("complete")?"System":t.phase,N=t.phase.endsWith("_tool"),l=t.phase.endsWith("_think"),n=t.text.replace(/^[âš¡âœ“â—]\s*/,"");N?h.push({ts:t.ts,agent:f,action:n,detail:t.toolOutput?z(t.toolOutput,120):"",type:"tool"}):t.phase==="complete"?h.push({ts:t.ts,agent:"Decision",action:n,detail:"",type:"decision"}):t.phase.startsWith("init")?h.push({ts:t.ts,agent:"Orchestrator",action:n,detail:"",type:"research"}):h.push({ts:t.ts,agent:f,action:n,detail:"",type:l?"analysis":"research"})}if(m){const t=[{key:"market",label:"Market"},{key:"moat",label:"Moat"},{key:"why_now",label:"Why Now"},{key:"execution",label:"Execution"},{key:"deal_fit",label:"Deal Fit"}];for(const f of t){const N=m[f.key];N?.score>0&&h.push({ts:"",agent:"Partner",action:`${f.label}: ${N.score}/100`,detail:N.reasons?.[0]||"",type:"score",score:N.score})}}const v={"Market Analyst":"#2563eb","Competition Analyst":"#7c3aed","Traction Analyst":"#0891b2",Associate:"#d97706",Partner:"#111827",Orchestrator:"#6b7280",Decision:"#16a34a",System:"#6b7280"},p={research:"â—Ž",evidence:"ðŸ“„",analysis:"â—‡",decision:"â—†",tool:"âš¡",score:"â˜…"};return e.jsxs("details",{className:"timeline-details",open:!0,children:[e.jsxs("summary",{className:"timeline-summary",children:[e.jsx("span",{className:"timeline-title",children:"Research Timeline"}),e.jsxs("span",{className:"timeline-meta",children:[h.length," events Â· ",Object.entries(d).map(([t,f])=>`${f} ${t}`).join(", ")]})]}),e.jsxs("div",{className:"timeline-container",children:[e.jsxs("div",{className:"timeline-lanes-header",children:[e.jsx("span",{className:"tl-lane-label",children:"Analysts"}),e.jsx("span",{className:"tl-lane-label",children:"Associate"}),e.jsx("span",{className:"tl-lane-label",children:"Partner"})]}),e.jsx("div",{className:"timeline-scroll",children:h.slice(-40).map((t,f)=>{const N=t.agent.includes("Analyst")||t.agent==="Orchestrator"?0:t.agent==="Associate"?1:2,l=v[t.agent]||"#6b7280";return e.jsxs("div",{className:`tl-row tl-lane-${N}`,style:{"--tl-color":l},children:[e.jsx("div",{className:"tl-dot",children:p[t.type]||"â—‹"}),e.jsxs("div",{className:"tl-content",children:[e.jsx("span",{className:"tl-agent",style:{color:l},children:t.agent}),e.jsx("span",{className:"tl-action",title:t.action,children:z(t.action,80)}),t.type==="score"&&t.score!==void 0&&e.jsx("span",{className:`tl-score ${re(t.score)}`,children:t.score})]})]},f)})})]})]})}function fe({slides:r,decision:y,avgScore:k,rubric:g,decisionGate:m,dealInput:b}){const[$,h]=w.useState(null),d=r.map(l=>{if(l.type==="recommendation"&&y&&y!=="PROCEED_IF"){const n=y==="STRONG_YES"?"INVEST":y==="PROCEED_IF"?"PROCEED WITH CONDITIONS":y;return{...l,subtitle:`${n} â€” Avg Score ${k}/100`,bullets:[`Decision: ${n}`,`Average rubric score: ${k}/100`,...l.bullets.slice(0,3)]}}return l}),v={cover:"",overview:"ðŸ¢",market:"ðŸ“ˆ",competition:"âš”ï¸",traction:"ðŸš€",thesis:"ðŸ’¡",risks:"âš ï¸",recommendation:"ðŸŽ¯"},p=()=>{const l=b?.name||b?.company_name||"Deal",n=new Date().toISOString().split("T")[0];let a=`# Investment Memo â€” ${l}
`;a+=`> Generated ${n} | Average Score: ${k}/100`,y&&(a+=` | Decision: **${y}**`),a+=`

---

`;for(const c of d){const u=v[c.type]||"";if(a+=`## ${u} ${c.title}

`,c.subtitle&&(a+=`*${c.subtitle}*

`),c.metrics&&c.metrics.length>0&&(a+=`| ${c.metrics.map(_=>_.label).join(" | ")} |
`,a+=`| ${c.metrics.map(()=>"---").join(" | ")} |
`,a+=`| ${c.metrics.map(_=>_.value).join(" | ")} |

`),c.bullets.length>0){for(const _ of c.bullets)a+=`- ${_}
`;a+=`
`}}if(g){a+=`---

## Rubric Scores

`,a+=`| Dimension | Score | Key Reasons |
`,a+=`| --- | --- | --- |
`;for(const[c,u]of Object.entries(g))if(u&&typeof u=="object"&&"score"in u){const _=(u.reasons||[]).slice(0,2).join("; ");a+=`| ${c.replace(/_/g," ")} | ${u.score}/100 | ${_} |
`}a+=`
`}if(m){if(a+=`## Decision Gate

`,a+=`**Decision:** ${m.decision}

`,m.gating_questions?.length>0){a+=`### Gating Questions

`;for(const c of m.gating_questions)a+=`1. ${c}
`;a+=`
`}if(m.evidence_checklist?.length>0){a+=`### Evidence Checklist

`;for(const c of m.evidence_checklist){const u=typeof c=="string"?c:c.text||c.item||JSON.stringify(c),_=typeof c=="object"&&c.status==="verified"?"x":" ";a+=`- [${_}] ${u}
`}a+=`
`}}return a+=`---

*Generated by DealBot â€” Cala + Specter + Dify*
`,{md:a,companyName:l,now:n}},t=(l,n,a,c)=>{try{const u=btoa(unescape(encodeURIComponent(l))),_=`data:${a};base64,${u}`;if(window.open(_,"_blank")){h(`${c} opened`),setTimeout(()=>h(null),3e3);return}}catch{}try{const u=new Blob([l],{type:a}),_=URL.createObjectURL(u),j=document.createElement("a");j.href=_,j.download=n,document.body.appendChild(j),j.click(),setTimeout(()=>{document.body.removeChild(j),URL.revokeObjectURL(_)},2e3),h(`${c} downloading`),setTimeout(()=>h(null),3e3);return}catch{}try{navigator.clipboard?.writeText(l).then(()=>{h(`${c} copied to clipboard`),setTimeout(()=>h(null),3e3)})}catch{h(`${c} failed`),setTimeout(()=>h(null),3e3)}},f=()=>{const{md:l,companyName:n,now:a}=p();t(l,`${n.replace(/[^a-zA-Z0-9]/g,"_")}_Memo_${a}.md`,"text/markdown;charset=utf-8",".md")},N=()=>{const l=b?.name||b?.company_name||"Deal",n=new Date().toISOString().split("T")[0],a=d.map((j,S)=>{const I=v[j.type]||"ðŸ“„";let M="";j.metrics&&j.metrics.length>0&&(M=`<div style="display:flex;gap:24px;margin:12px 0;flex-wrap:wrap">${j.metrics.map(O=>`<div style="text-align:center"><div style="font-size:20px;font-weight:700;color:#1e293b">${O.value}</div><div style="font-size:11px;color:#64748b;text-transform:uppercase">${O.label}</div></div>`).join("")}</div>`);const H=j.bullets.length>0?`<ul style="margin:8px 0;padding-left:18px;color:#334155;font-size:13px;line-height:1.7">${j.bullets.map(O=>`<li>${O}</li>`).join("")}</ul>`:"";return j.type==="cover"?`<div style="background:linear-gradient(135deg,#0f172a,#1e3a5f);color:#fff;padding:60px 40px;min-height:280px;display:flex;flex-direction:column;justify-content:flex-end;border-radius:8px;margin-bottom:20px;page-break-after:always">
          <h1 style="font-size:32px;margin:0 0 8px">${j.title}</h1>
          <p style="font-size:16px;opacity:0.8;margin:0">${j.subtitle||""}</p>
          ${j.bullets.map(O=>`<p style="font-size:13px;opacity:0.6;margin:4px 0">${O}</p>`).join("")}
        </div>`:`<div style="border:1px solid #e2e8f0;border-radius:8px;padding:24px;margin-bottom:16px;page-break-inside:avoid">
        <div style="display:flex;align-items:center;gap:8px;margin-bottom:12px">
          <span style="font-size:10px;color:#94a3b8;font-weight:600">${String(S+1).padStart(2,"0")}</span>
          <span style="font-size:16px">${I}</span>
          <div><div style="font-size:16px;font-weight:600;color:#0f172a">${j.title}</div>${j.subtitle?`<div style="font-size:12px;color:#64748b">${j.subtitle}</div>`:""}</div>
        </div>
        ${M}${H}
      </div>`}).join(`
`);let c="";g&&(c=`<div style="border:1px solid #e2e8f0;border-radius:8px;padding:24px;margin-bottom:16px;page-break-inside:avoid">
        <h3 style="font-size:16px;font-weight:600;color:#0f172a;margin:0 0 12px">Rubric Scores</h3>
        <table style="width:100%;border-collapse:collapse;font-size:13px"><thead><tr style="background:#f8fafc">
          <th style="text-align:left;padding:6px 8px;border-bottom:1px solid #e2e8f0">Dimension</th>
          <th style="text-align:center;padding:6px 8px;border-bottom:1px solid #e2e8f0">Score</th>
          <th style="text-align:left;padding:6px 8px;border-bottom:1px solid #e2e8f0">Key Reasons</th>
        </tr></thead><tbody>
        ${Object.entries(g).map(([j,S])=>{if(!S||typeof S!="object"||!("score"in S))return"";const I=(S.reasons||[]).slice(0,2).join("; "),M=S.score>=70?"#16a34a":S.score>=40?"#d97706":"#dc2626";return`<tr><td style="padding:6px 8px;border-bottom:1px solid #f1f5f9">${j.replace(/_/g," ")}</td>
            <td style="text-align:center;padding:6px 8px;border-bottom:1px solid #f1f5f9;font-weight:700;color:${M}">${S.score}</td>
            <td style="padding:6px 8px;border-bottom:1px solid #f1f5f9;color:#64748b;font-size:12px">${I}</td></tr>`}).join("")}
        </tbody></table></div>`);let u="";if(m&&m.decision){const j=m.decision==="STRONG_YES"?"#16a34a":m.decision==="PASS"||m.decision==="KILL"?"#dc2626":"#d97706";u=`<div style="border:2px solid ${j};border-radius:8px;padding:20px;margin-bottom:16px">
        <div style="font-size:18px;font-weight:700;color:${j};margin-bottom:12px">Decision: ${m.decision}</div>
        ${m.gating_questions?.length>0?`<div style="font-size:14px;font-weight:600;margin-bottom:8px">Gating Questions</div><ol style="margin:0;padding-left:18px;font-size:13px;color:#334155;line-height:1.8">${m.gating_questions.map(S=>`<li>${S}</li>`).join("")}</ol>`:""}
      </div>`}const _=`<!DOCTYPE html><html><head><meta charset="utf-8"><title>${l} â€” Investment Memo</title>
      <style>body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;max-width:800px;margin:0 auto;padding:20px;color:#0f172a}@media print{body{padding:0}}</style>
    </head><body>${a}${c}${u}
      <div style="text-align:center;font-size:11px;color:#94a3b8;margin-top:24px;padding:12px;border-top:1px solid #e2e8f0">Generated by DealBot â€” ${n}</div>
    </body></html>`;t(_,`${l.replace(/[^a-zA-Z0-9]/g,"_")}_Memo_${n}.html`,"text/html;charset=utf-8",".pdf")};return e.jsxs("details",{className:"memo-details",open:!0,children:[e.jsxs("summary",{className:"memo-summary",children:[e.jsx("span",{className:"memo-summary-title",children:"Investment Memo"}),e.jsxs("span",{className:"memo-summary-actions",children:[e.jsx("button",{className:"memo-download-btn",onClick:l=>{l.stopPropagation(),l.preventDefault(),f()},title:"Download or copy Markdown memo",children:$===".md"||$===".md copied"?"âœ“ Copied":".md"}),e.jsx("button",{className:"memo-download-btn memo-download-pdf",onClick:l=>{l.stopPropagation(),l.preventDefault(),N()},title:"Download or copy HTML memo",children:$===".pdf"||$===".pdf copied"?"âœ“ Copied":".pdf"}),e.jsxs("span",{className:"memo-summary-meta",children:[r.length," slides"]})]})]}),e.jsx("div",{className:"memo-deck",children:d.map((l,n)=>e.jsxs("div",{className:`memo-slide memo-${l.type}`,children:[l.imageUrl&&e.jsx("div",{className:"memo-cover-img",style:{backgroundImage:`url(${l.imageUrl})`},children:e.jsxs("div",{className:"memo-cover-overlay",children:[e.jsx("div",{className:"memo-cover-title",children:l.title}),l.subtitle&&e.jsx("div",{className:"memo-cover-sub",children:l.subtitle})]})}),!l.imageUrl&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"memo-slide-header",children:[e.jsx("span",{className:"memo-slide-num",children:String(n+1).padStart(2,"0")}),e.jsx("span",{className:"memo-slide-icon",children:v[l.type]||"ðŸ“„"}),e.jsxs("div",{children:[e.jsx("div",{className:"memo-slide-title",children:l.title}),l.subtitle&&e.jsx("div",{className:"memo-slide-sub",children:l.subtitle})]})]}),l.metrics&&l.metrics.length>0&&e.jsx("div",{className:"memo-metrics",children:l.metrics.map((a,c)=>e.jsxs("div",{className:"memo-metric",children:[e.jsx("div",{className:"memo-metric-val",children:a.value}),e.jsx("div",{className:"memo-metric-label",children:a.label})]},c))}),l.bullets.length>0&&e.jsx("ul",{className:"memo-bullets",children:l.bullets.map((a,c)=>e.jsx("li",{className:"memo-bullet",children:a},c))})]})]},n))})]})}function ye({updates:r,isComplete:y}){const k=r.filter(d=>d.phase==="init_stage"||d.phase==="founder_deep_dive"),g=r.filter(d=>d.phase==="source_found"),m=r.filter(d=>d.phase==="intel_query"),b=r.filter(d=>d.phase==="intel_result");if([...k,...g,...m,...b].length===0)return null;const h=r.some(d=>d.phase.startsWith("analyst_"));return y&&g.length===0?null:e.jsxs("details",{className:"source-feed",open:!h,children:[e.jsxs("summary",{className:"source-feed-header",children:[e.jsx("span",{className:"source-feed-label",children:"EVIDENCE COLLECTION"}),e.jsxs("span",{className:"source-feed-count",children:[g.length+b.filter(d=>d.text.startsWith("âœ…")).length," sources"]})]}),e.jsxs("div",{className:"source-feed-items",children:[k.map((d,v)=>e.jsx("div",{className:"src-item src-stage",style:{animationDelay:`${v*.08}s`},children:e.jsx("span",{className:"src-text",children:d.text})},`s-${v}`)),g.map((d,v)=>e.jsx("div",{className:"src-item src-source",style:{animationDelay:`${(k.length+v)*.08}s`},children:e.jsx("span",{className:"src-text",children:d.text})},`e-${v}`)),b.length>0&&e.jsx("div",{className:"src-intel-grid",children:b.map((d,v)=>e.jsx("div",{className:`src-intel-chip ${d.text.startsWith("âœ…")?"src-intel-hit":"src-intel-miss"}`,style:{animationDelay:`${v*.1}s`},children:d.text.replace(/^[âœ…â—‹]\s*/,"")},`i-${v}`))})]})]})}const q=[{value:"angel",label:"Angel",emoji:"ðŸ‘¼"},{value:"early_vc",label:"Early VC",emoji:"ðŸš€"},{value:"growth_vc",label:"Growth VC",emoji:"ðŸ“ˆ"},{value:"late_vc",label:"Late VC",emoji:"ðŸ›ï¸"},{value:"pe",label:"PE",emoji:"ðŸ¦"},{value:"ib",label:"IB",emoji:"ðŸ’¼"}];function ve({firmType:r,aum:y,dealId:k,onSwitch:g,sendFollowUp:m}){const[b,$]=w.useState(!1),[h,d]=w.useState(r||"early_vc"),[v,p]=w.useState(y||""),[t,f]=w.useState(!1);w.useEffect(()=>{r&&d(r)},[r]),w.useEffect(()=>{y&&p(y)},[y]);const N=q.find(n=>n.value===(r||"early_vc"))||q[1],l=async n=>{if(!k)return;f(!0);const a=q.find(c=>c.value===h)?.label||h;g(h,v),$(!1),m&&m(n?`Re-run the deal analysis for deal_id="${k}" with investor lens: ${a}${v?`, AUM: ${v}`:""}. Use run_deal then show deal-dashboard.`:`Updated investor profile to ${a}${v?` with AUM ${v}`:""}. Show deal-dashboard for deal_id="${k}".`),f(!1)};return e.jsxs("div",{className:"inv-profile-bar",children:[e.jsxs("button",{className:"inv-badge",onClick:()=>$(!b),title:"Switch investor profile",children:[e.jsx("span",{className:"inv-badge-emoji",children:N.emoji}),e.jsx("span",{className:"inv-badge-label",children:N.label}),y&&e.jsx("span",{className:"inv-badge-aum",children:y}),e.jsx("span",{className:"inv-badge-arrow",children:b?"â–²":"â–¼"})]}),b&&e.jsxs("div",{className:"inv-dropdown",children:[e.jsx("div",{className:"inv-dropdown-title",children:"Investor Lens"}),e.jsx("div",{className:"inv-firm-grid",children:q.map(n=>e.jsxs("button",{className:`inv-firm-btn ${h===n.value?"inv-firm-active":""}`,onClick:()=>d(n.value),children:[e.jsx("span",{children:n.emoji}),e.jsx("span",{children:n.label})]},n.value))}),e.jsx("input",{className:"inv-aum-input",type:"text",placeholder:"AUM (e.g. $50M, $500M, $2B)",value:v,onChange:n=>p(n.target.value)}),e.jsxs("div",{className:"inv-actions",children:[e.jsx("button",{className:"inv-apply",onClick:()=>l(!1),disabled:t,children:t?"â€¦":"Save"}),e.jsx("button",{className:"inv-apply inv-apply-rerun",onClick:()=>l(!0),disabled:t,children:t?"â€¦":"Save & Re-run"})]})]})]})}function je(){const{isSuccess:r,output:y,isPending:k,input:g}=he(),m=Z("deal-dashboard"),b=Z("run_deal"),$=Z("list_deals"),h=ue(),[d,v]=w.useState(!1),[p,t]=w.useState(!1),[f,N]=w.useState(!1),[l,n]=w.useState(null),[a,c]=w.useState(!1),u=w.useRef(null),_=w.useRef(0),j=w.useRef(Date.now()),S=m.isPending,I=m.callTool,M=s=>`dealbot_state_${s}`,H=(s,o)=>{try{localStorage.setItem(M(s),JSON.stringify({...o,_cached_at:new Date().toISOString()}))}catch{}},O=s=>{try{const o=localStorage.getItem(M(s));return o?JSON.parse(o):null}catch{return null}},F=w.useRef(null);if(m.isSuccess&&m.data?.structuredContent){const s=m.data.structuredContent;if(s.error==="not_found"){const o=s.deal_id||g?.deal_id||"";if(o&&!F.current){const W=O(o);W&&(F.current={...W,_from_cache:!0})}u.current&&(clearInterval(u.current),u.current=null)}else{F.current=s,_.current=0,j.current=Date.now();const o=s.deal_id||g?.deal_id||"";o&&H(o,s)}}m.isError&&(_.current++,_.current>=3&&u.current&&(clearInterval(u.current),u.current=null));const ee=F.current||y,i=r&&ee?ee:null,C=i?.deal_id||g?.deal_id||"",B=i?!i.isComplete&&!i.error:!1;if(w.useEffect(()=>(B&&C&&!u.current&&_.current<3&&(u.current=setInterval(()=>{C&&!S&&I({deal_id:C})},12e3)),(!B||_.current>=3)&&u.current&&(clearInterval(u.current),u.current=null),()=>{u.current&&(clearInterval(u.current),u.current=null)}),[B,C]),k||!r||!y)return e.jsx("div",{className:"loading",children:"Loading deal analysis..."});if(!i)return null;if(i.error==="not_found"&&!i._from_cache){const s=g?.company_name||g?.deal_id||"",o=g?.deal_id||i.deal_id||"";return e.jsxs("div",{className:"widget deal-pipe",children:[e.jsxs("div",{className:"pipe-header",style:{textAlign:"center",padding:"32px 24px"},children:[e.jsx("div",{style:{fontSize:32,marginBottom:8,opacity:.5},children:"âŸ³"}),e.jsx("div",{className:"pipe-title",style:{fontSize:18},children:"Session Unavailable"}),e.jsx("div",{className:"pipe-subtitle",style:{maxWidth:400,margin:"8px auto",lineHeight:1.5},children:"This deal analysis session is no longer cached on the server. On serverless infrastructure, data is ephemeral between cold starts."}),o&&e.jsx("div",{style:{fontSize:11,opacity:.4,fontFamily:"monospace",marginTop:8},children:o})]}),e.jsxs("div",{style:{display:"flex",gap:8,padding:"0 24px 24px",justifyContent:"center"},children:[e.jsx("button",{className:"cp-btn-process",style:{maxWidth:200},onClick:()=>{h(s?`Analyze the company "${s}" â€” use analyze_deal tool`:"Start a new deal analysis â€” ask me which company")},children:"Re-analyze"}),e.jsx("button",{className:"action-btn",style:{padding:"8px 16px"},onClick:()=>{h("Show me my recent deal analysis history")},children:"View History"})]})]})}const{pipeline:x,liveUpdates:T,isComplete:E,avgScore:V}=i,D=i.rubric,R=i.decision_gate;if(!x?.analysts||!Array.isArray(x.analysts))return e.jsx("div",{className:"loading",children:"Loading pipeline dataâ€¦"});const L=D?.market?.score>0,Y=x.analysts.filter(s=>s.status==="done").length,se=x.analysts.reduce((s,o)=>s+o.factCount,0),te=x.analysts.some(s=>s.status==="running"),ne=x.associate?.status==="running",ae=x.partner?.status==="running",ce=ae?"Partner reviewing...":ne?"Associate analyzing...":te?`Analyst researching (${Y}/${x.analysts.length} done)...`:d?"Starting agents...":E?"":"Processing...";return e.jsx(le,{content:`Deal analysis: ${i.deal_input?.name||"unknown"}${i.company_profile?.domain?` (${i.company_profile.domain})`:""}. Status: ${E?"COMPLETE":te?"analysts researching":ne?"associate synthesizing":ae?"partner deciding":"processing"}. Analysts: ${Y}/${x.analysts.length} done, ${se} facts. ${L?`Scores: market=${D.market.score}, moat=${D.moat.score}, execution=${D.execution.score}, avg=${V}. Decision: ${R?.decision}.`:"Scoring pending."} Evidence: ${i.evidence?.length||0} items.`,children:e.jsxs("div",{className:"widget deal-pipe",children:[e.jsxs("div",{className:"pipe-header",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"pipe-label",children:["Deal Analysis Run",i._from_cache?e.jsx("span",{style:{marginLeft:8,fontSize:10,color:"#9ca3af",background:"#f3f4f6",padding:"1px 6px",borderRadius:4},children:"cached snapshot"}):null]}),e.jsx("div",{className:"pipe-title",children:i.deal_input?.name||"Deal"}),e.jsxs("div",{className:"pipe-subtitle",children:[i.created_at?new Date(i.created_at).toLocaleDateString():"Today"," Â· ",i.evidence?.length||0," evidence",i.company_profile?.domain?` Â· ${i.company_profile.domain}`:"",E?" Â· Complete":"",!E&&e.jsxs("span",{className:"live-inline",children:[e.jsx("span",{className:"live-dot-sm"}),ce||"Agents initializing..."," Â· ",T.length," events"]})]})]}),e.jsxs("div",{style:{display:"flex",gap:6},children:[e.jsx("button",{className:`action-btn action-btn-retry ${d?"action-btn-spinning":""}`,disabled:d||b.isPending,onClick:()=>{C&&(v(!0),b.callTool({deal_id:C}),setTimeout(()=>{C&&I({deal_id:C})},3e3),setTimeout(()=>v(!1),6e3))},title:"Re-run the full deal analysis pipeline",children:d||b.isPending?"âŸ³ Startingâ€¦":"â†» Retry"}),e.jsx("button",{className:"action-btn",onClick:()=>{C&&(_.current=0,I({deal_id:C}))},disabled:S,children:S?"Checkingâ€¦":"Refresh"}),e.jsx("button",{className:"action-btn",onClick:()=>{N(!f),f||$.callTool({})},title:"View history of deal analysis runs",children:e.jsxs("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",style:{verticalAlign:"middle"},children:[e.jsx("circle",{cx:"12",cy:"12",r:"10"}),e.jsx("polyline",{points:"12 6 12 12 16 14"})]})})]})]}),e.jsx("div",{className:`history-backdrop ${f?"history-backdrop-open":""}`,onClick:()=>N(!1)}),e.jsxs("div",{className:`history-panel ${f?"history-panel-open":""}`,children:[e.jsxs("div",{className:"history-header",children:[e.jsx("span",{className:"history-title",children:"Deal History"}),e.jsx("button",{className:"history-close",onClick:()=>N(!1),children:"Ã—"})]}),e.jsxs("div",{className:"history-list",children:[$.isPending&&e.jsxs("div",{className:"history-loading",children:[e.jsx("span",{className:"cp-spinner"})," Loading history..."]}),$.isSuccess&&(()=>{const s=$.data?.structuredContent?.deals||[];return s.length===0?e.jsx("div",{className:"history-empty",children:"No deal runs found"}):s.slice(0,20).map(o=>e.jsxs("button",{className:`history-item ${o.id===C||o.deal_id===C?"history-item-active":""}`,onClick:()=>{I({deal_id:o.id||o.deal_id}),N(!1)},children:[e.jsx("div",{className:"history-item-name",children:o.name||o.domain||o.id||o.deal_id}),e.jsxs("div",{className:"history-item-meta",children:[o.latest_decision&&e.jsx("span",{className:`history-decision ${oe(o.latest_decision)}`,children:o.latest_decision}),e.jsx("span",{className:"history-item-date",children:o.updated_at?new Date(o.updated_at).toLocaleDateString():""})]}),e.jsxs("div",{className:"history-item-stats",children:[o.evidence_count||0," evidence Â· ",o.latest_avg_score?`${o.latest_avg_score}/100`:"No score"]})]},o.id||o.deal_id))})()]})]}),e.jsx(ve,{firmType:i.deal_input?.firm_type,aum:i.deal_input?.aum,dealId:C,sendFollowUp:h,onSwitch:(s,o)=>{i.deal_input&&(i.deal_input.firm_type=s,i.deal_input.aum=o),C&&I({deal_id:C})}}),e.jsx(ye,{updates:T,isComplete:E}),e.jsxs("div",{className:"pipe-stage",children:[e.jsxs("div",{className:"pipe-stage-header",children:[e.jsx("span",{className:"pipe-stage-label",children:"ANALYSTS"}),e.jsxs("span",{className:"pipe-stage-count",children:[Y,"/",x.analysts.length," Â· ",se," facts"]})]}),x.analysts.map((s,o)=>{const W=`analyst_${o+1}`,de=U(T,W);return e.jsx(le,{content:`${s.specialization} analyst: ${s.status}${s.status==="done"?`, ${s.factCount} facts, ${s.unknownCount} unknowns`:""}`,children:e.jsxs("details",{className:`toggle-node ${P(s.status)}`,open:s.status==="running"||s.status==="done"&&!E,children:[e.jsxs("summary",{className:"toggle-summary",children:[e.jsx("span",{className:`agent-status ${P(s.status)}`,children:G(s.status)}),e.jsx("span",{className:"toggle-role",children:s.specialization}),s.status==="done"&&e.jsxs("span",{className:"toggle-stats",children:[s.factCount," facts Â· ",s.unknownCount," unknowns"]}),s.status==="running"&&e.jsx("span",{className:"toggle-stats pulse-text",children:"researchingâ€¦"}),s.status==="pending"&&e.jsx("span",{className:"toggle-stats dim",children:"queued"})]}),e.jsxs("div",{className:"toggle-feed",children:[e.jsx(X,{feed:de,isDone:s.status==="done",isRunning:s.status==="running",phasePrefix:W}),s.status==="done"&&s.topFacts.length>0&&e.jsx("div",{className:"feed-facts",children:s.topFacts.map((A,K)=>e.jsx("div",{className:"feed-fact",children:A},K))}),s.status==="done"&&s.topUnknowns.length>0&&e.jsx("div",{className:"feed-unknowns",children:s.topUnknowns.map((A,K)=>{const Q=typeof A=="object"&&A!==null,me=Q?A.question:A,J=Q?A.resolved:!1,ie=Q?A.answer:null;return e.jsxs("div",{className:`feed-unknown ${J?"feed-unknown-resolved":""}`,children:[e.jsxs("div",{children:[J?"âœ…":"?"," ",me]}),J&&ie&&e.jsxs("div",{className:"unknown-answer",children:["â†’ ",z(ie,180)]})]},K)})})]})]},s.id)})})]}),e.jsx("div",{className:"pipe-connector"}),e.jsxs("details",{className:`toggle-node ${P(x.associate.status)}`,open:x.associate.status!=="pending",children:[e.jsxs("summary",{className:"toggle-summary",children:[e.jsx("span",{className:`agent-status ${P(x.associate.status)}`,children:G(x.associate.status)}),e.jsx("span",{className:"toggle-role",children:"Associate"}),x.associate.hypothesisCount>0&&e.jsxs("span",{className:"toggle-stats",children:[x.associate.hypothesisCount," hypotheses"]}),x.associate.status==="running"&&e.jsx("span",{className:"toggle-stats pulse-text",children:"synthesizingâ€¦"}),x.associate.status==="pending"&&e.jsx("span",{className:"toggle-stats dim",children:"awaiting analysts"})]}),e.jsxs("div",{className:"toggle-feed",children:[e.jsx(X,{feed:U(T,"associate"),isDone:x.associate.status==="done",isRunning:x.associate.status==="running",phasePrefix:"associate"}),x.associate.topHypotheses.map((s,o)=>e.jsxs("div",{className:"hypothesis-card",children:[e.jsx("div",{className:"hypothesis-text",children:z(s.text,120)}),s.risks.length>0&&e.jsxs("div",{className:"hypothesis-risk",children:["Risk: ",s.risks[0]]})]},o))]})]}),i.memo&&i.memo.length>0&&x.associate.status==="done"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"pipe-connector"}),e.jsx(fe,{slides:i.memo,decision:R?.decision,avgScore:V,rubric:i.rubric,decisionGate:i.decision_gate,dealInput:i.deal_input})]}),e.jsx("div",{className:"pipe-connector"}),e.jsxs("details",{className:`toggle-node ${P(x.partner.status)}`,open:x.partner.status!=="pending",children:[e.jsxs("summary",{className:"toggle-summary",children:[e.jsx("span",{className:`agent-status ${P(x.partner.status)}`,children:G(x.partner.status)}),e.jsx("span",{className:"toggle-role",children:"Partner"}),L&&e.jsxs("span",{className:"toggle-stats",children:["Avg ",V,"/100"]}),x.partner.status==="running"&&e.jsx("span",{className:"toggle-stats pulse-text",children:"scoringâ€¦"}),x.partner.status==="pending"&&e.jsx("span",{className:"toggle-stats dim",children:"awaiting synthesis"})]}),e.jsxs("div",{className:"toggle-feed",children:[e.jsx(X,{feed:U(T,"partner"),isDone:x.partner.status==="done"||L,isRunning:x.partner.status==="running",phasePrefix:"partner"}),L&&e.jsx(xe,{scores:[{label:"Market",value:D.market.score},{label:"Moat",value:D.moat.score},{label:"Why Now",value:D.why_now.score},{label:"Exec",value:D.execution.score},{label:"Fit",value:D.deal_fit.score}]}),L&&e.jsx("div",{className:"partner-rubric-table",children:Object.entries(D).map(([s,o])=>e.jsxs("div",{className:"rubric-row",children:[e.jsx("span",{className:"rubric-dim",children:s.replace(/_/g," ")}),e.jsxs("span",{className:`rubric-score ${re(o.score)}`,children:[o.score,"/100"]}),e.jsx("span",{className:"rubric-reason",children:o.reasons?.[0]?z(o.reasons[0],80):""})]},s))}),L&&e.jsx("div",{className:"partner-reasons",children:[D.market,D.moat,D.execution].flatMap(s=>s.reasons.slice(0,1)).slice(0,3).map((s,o)=>e.jsx("div",{className:"feed-fact",children:z(s,90)},o))}),x.partner.status==="done"&&!L&&U(T,"partner").length===0&&e.jsx("div",{className:"feed-item feed-done",children:"Partner review complete â€” scores pending"})]})]}),E&&R&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:`decision-banner ${oe(R.decision)}`,children:R.decision==="STRONG_YES"?"INVEST":R.decision==="PROCEED_IF"?"PROCEED WITH CONDITIONS":R.decision}),R.gating_questions?.length>0&&R.gating_questions[0]!=="Pending..."&&e.jsxs("div",{className:"gating-section",children:[e.jsx("div",{className:"section-title",children:"Gating Questions for IC"}),e.jsx("ul",{className:"gating-questions",children:R.gating_questions.map((s,o)=>e.jsx("li",{children:s},o))})]})]}),T.length>3&&e.jsx(ge,{liveUpdates:T,analysts:x.analysts,associate:x.associate,partner:x.partner,rubric:i.rubric,decision:R?.decision||"PENDING",evidence:i.evidence||[]}),e.jsxs("div",{style:{display:"flex",gap:8,flexWrap:"wrap",marginTop:8},children:[!E&&e.jsx("button",{className:"action-btn action-btn-primary",onClick:()=>{C&&(_.current=0,I({deal_id:C}))},disabled:S,children:S?"Checkingâ€¦":"Check Progress"}),i.company_profile?.domain&&e.jsx("button",{className:"action-btn",onClick:()=>{c(!0),h(`Call the company-profile tool with domain="${i.company_profile.domain}". Do not add commentary.`),setTimeout(()=>c(!1),3e3)},disabled:a,children:a?"Openingâ€¦":"Company Profile"}),i.evidence?.length>0&&e.jsx("button",{className:`action-btn ${p?"action-btn-active":""}`,onClick:()=>t(s=>!s),children:p?"Hide Evidence":`Evidence (${i.evidence.length})`})]}),p&&i.evidence?.length>0&&e.jsxs("div",{className:"evidence-panel",children:[e.jsxs("div",{className:"evidence-panel-header",children:[e.jsxs("span",{className:"evidence-panel-title",children:[i.evidence.length," Evidence Items"]}),e.jsx("button",{className:"evidence-close",onClick:()=>t(!1),children:"Ã—"})]}),e.jsxs("div",{className:"evidence-list",children:[i.evidence.slice(0,20).map((s,o)=>e.jsxs("div",{className:"evidence-item",children:[e.jsxs("div",{className:"evidence-source",children:[e.jsx("span",{className:`evidence-badge evidence-badge-${s.source||"unknown"}`,children:s.source||"unknown"}),s.url&&e.jsx("a",{className:"evidence-url",href:s.url,target:"_blank",rel:"noopener noreferrer",children:"â†—"})]}),e.jsx("div",{className:"evidence-title",children:s.title||s.evidence_id}),e.jsx("div",{className:"evidence-snippet",children:(s.snippet||"").length>200?s.snippet.slice(0,200)+"â€¦":s.snippet})]},o)),i.evidence.length>20&&e.jsxs("div",{className:"evidence-more",children:["+",i.evidence.length-20," more items"]})]})]}),E&&e.jsxs("div",{className:"next-steps",children:[e.jsx("div",{className:"next-steps-title",children:"Next Steps"}),e.jsxs("div",{className:"next-steps-grid",children:[i.company_profile?.founders?.length>0&&e.jsxs("button",{className:"next-step-card",onClick:()=>h(`Map out profiles and outreach strategy for the founders of ${i.deal_input?.name}: ${i.company_profile.founders.join(", ")}. Include LinkedIn profiles and a concise outreach message referencing our analysis.`),children:[e.jsx("span",{className:"next-step-icon",children:"ðŸ‘¤"}),e.jsx("span",{className:"next-step-label",children:"Founder Outreach"}),e.jsxs("span",{className:"next-step-desc",children:["Map ",i.company_profile.founders.length," founder",i.company_profile.founders.length>1?"s":""," & draft outreach"]})]}),e.jsxs("button",{className:"next-step-card",onClick:()=>h(`Set up monitoring triggers for ${i.deal_input?.name} using the trigger-setup tool. Track: key revenue updates, key hires, key partnerships, key deals won, key business model updates, key setbacks.`),children:[e.jsx("span",{className:"next-step-icon",children:"ðŸ””"}),e.jsx("span",{className:"next-step-label",children:"Monitor Triggers"}),e.jsx("span",{className:"next-step-desc",children:"Track key events via Cala AI alerts"})]}),i.company_profile?.domain&&e.jsxs("button",{className:"next-step-card",onClick:()=>h(`Do a competitive deep dive on ${i.deal_input?.name}'s key competitors using Specter similar companies for ${i.company_profile.domain}. Compare funding, team size, and traction.`),children:[e.jsx("span",{className:"next-step-icon",children:"âš”ï¸"}),e.jsx("span",{className:"next-step-label",children:"Competitor Deep Dive"}),e.jsx("span",{className:"next-step-desc",children:"Full competitive landscape analysis"})]}),e.jsxs("button",{className:"next-step-card",onClick:()=>h(`Re-analyze ${i.deal_input?.name} with a different investor lens. Current: ${i.deal_input?.firm_type||"early_vc"}. What other fund type should we evaluate from?`),children:[e.jsx("span",{className:"next-step-icon",children:"ðŸ”„"}),e.jsx("span",{className:"next-step-label",children:"Switch Investor Lens"}),e.jsx("span",{className:"next-step-desc",children:"Re-evaluate from a different fund perspective"})]})]})]})]})})}class Ne extends w.Component{constructor(y){super(y),this.state={hasError:!1,error:""}}static getDerivedStateFromError(y){return{hasError:!0,error:y.message||"Unknown error"}}render(){return this.state.hasError?e.jsxs("div",{className:"widget deal-pipe",children:[e.jsxs("div",{className:"pipe-header",children:[e.jsx("div",{className:"pipe-title",children:"Dashboard Error"}),e.jsx("div",{className:"pipe-subtitle",children:"Something went wrong rendering the dashboard. Try refreshing."})]}),e.jsx("div",{style:{padding:"12px",fontSize:"12px",color:"#999",fontFamily:"monospace"},children:this.state.error}),e.jsx("button",{className:"cp-btn-process",onClick:()=>this.setState({hasError:!1,error:""}),children:"Retry"})]}):this.props.children}}function be(){return e.jsx(Ne,{children:e.jsx(je,{})})}pe(e.jsx(be,{}));
